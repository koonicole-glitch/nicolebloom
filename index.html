<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nicole 2026 ç¾å¤¢æˆçœŸè¨ˆç•« v3.0 (Expanded)</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŒ¿</text></svg>">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4322/4322991.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#FFFBF5">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bgMain: '#FFFBF5', cardBg: '#FFFFFF', primary: '#4A5D23', secondary: '#6B5E52',
                        inputBg: '#F5F2EB', borderBeige: '#E8E4D9', activeTab: '#4A5D23', inactiveTab: '#A8A29E'
                    },
                    borderRadius: { 'xl': '14px', '2xl': '20px' }
                }
            }
        }
    </script>

    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        body { background-color: #FFFBF5; color: #4A5D23; font-family: system-ui, -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; }
        input, select, button, textarea, p, span, div { font-size: 18px; }
        h1 { font-size: 24px; } h2 { font-size: 22px; } h3 { font-size: 20px; }
        .big-num { font-size: 48px; font-weight: 800; line-height: 1; }
        .card-shadow { box-shadow: 0 4px 12px rgba(74, 93, 35, 0.08); }
        input:focus, textarea:focus { outline: 2px solid #4A5D23; background-color: #ffffff; }
        .markdown-body p { margin-bottom: 1em; line-height: 1.6; }
        .markdown-body ul { list-style: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .chat-bubble { max-width: 85%; padding: 12px 16px; border-radius: 18px; line-height: 1.5; margin-bottom: 8px; position: relative; }
        .chat-user { background-color: #4A5D23; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        .chat-ai { background-color: #F5F2EB; color: #4A5D23; align-self: flex-start; border-bottom-left-radius: 4px; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 50; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>
    <div id="root">
        <div style="height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #4A5D23;">
            <div style="font-size: 40px; margin-bottom: 20px;">ğŸŒ¿</div>
            <div>æ­£åœ¨å•Ÿå‹• Health Log...</div>
            <div id="error-msg" style="font-size: 12px; margin-top: 20px; color: red; max-width: 80%; text-align: center;"></div>
        </div>
    </div>

    <script>
        window.onerror = function(msg, url, line) {
            document.getElementById('error-msg').innerText = "ç³»çµ±éŒ¯èª¤: " + msg + " (Line: " + line + ")";
        };
    </script>

    <script type="text/babel">
        // 1. Firebase åˆå§‹åŒ–
        const firebaseConfig = {
            apiKey: "AIzaSyD6FsP4PtdeeD_uuIRnWbbLzsKwHlgS9cM",
            authDomain: "health-tracker-b37e4.firebaseapp.com",
            projectId: "health-tracker-b37e4",
            storageBucket: "health-tracker-b37e4.firebasestorage.app",
            messagingSenderId: "802888614022",
            appId: "1:802888614022:web:e7ec85eef3dfc088aed107"
        };
        if (typeof firebase !== 'undefined' && !firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // 2. å·¥å…·èˆ‡å‡½å¼
        const { useState, useEffect, useMemo, useRef } = React;
        const Recharts = window.Recharts || {};
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } = Recharts;

        const getTodayString = () => { const d = new Date(); const off = d.getTimezoneOffset() * 60000; return new Date(d.getTime() - off).toISOString().split('T')[0]; };
        const shiftDate = (d, n) => { const dt = new Date(d); dt.setDate(dt.getDate() + n); return dt.toISOString().split('T')[0]; };
        const MEAL_CATEGORIES = { 'breakfast': 'æ—©é¤', 'lunch': 'åˆé¤', 'dinner': 'æ™šé¤', 'snack': 'é»å¿ƒ' };
        
        const getDefaultMealCategory = () => {
            const h = new Date().getHours();
            if (h >= 5 && h < 11) return 'breakfast';
            if (h >= 11 && h < 15) return 'lunch';
            if (h >= 17 && h < 21) return 'dinner';
            return 'snack';
        };
        
        const fallbackAnalysis = (text) => {
            let c=0, p=0, cb=0, f=0; const t = text.toLowerCase();
            if (t.includes('é›') || t.includes('è‚‰') || t.includes('é­š')) { c+=200; p+=25; f+=10; }
            if (t.includes('é£¯') || t.includes('ç²¥') || t.includes('éºµ')) { c+=280; p+=4; cb+=60; }
            if (t.includes('èœ') || t.includes('è”¬')) { c+=50; cb+=10; }
            if (t.includes('è›‹')) { c+=75; p+=7; f+=5; }
            if (c===0 && t.length>0) c=200;
            return { name: text, calories: c, protein: p, carbs: cb, fat: f };
        };

        // 3. é€šç”¨å…ƒä»¶
        const Loading = () => {
            const [s, setS] = useState(false);
            useEffect(() => { const t = setTimeout(() => setS(true), 5000); return () => clearTimeout(t); }, []);
            return (
                <div className="flex h-screen items-center justify-center bg-bgMain text-primary flex-col p-6 text-center">
                    <span className="material-icons text-6xl animate-bounce mb-4">fitness_center</span>
                    <p className="text-xl font-bold mb-8">è¼‰å…¥ä¸­...</p>
                    {s && <button onClick={()=>{localStorage.removeItem('health_log_sync_id');window.location.reload()}} className="bg-red-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg">âš ï¸ é‡ç½®</button>}
                </div>
            );
        };

        const Card = ({ children, className = "", onClick }) => (
            <div onClick={onClick} className={`bg-cardBg rounded-2xl p-6 card-shadow border border-borderBeige ${className}`}>
                {children}
            </div>
        );

        const Button = ({ children, onClick, variant = 'primary', className = "", disabled=false }) => {
            const s = { primary: "bg-primary text-white shadow-lg", secondary: "bg-secondary text-white", outline: "border-2 border-primary text-primary bg-transparent" };
            return (
                <button onClick={onClick} disabled={disabled} className={`w-full py-4 rounded-xl font-bold text-